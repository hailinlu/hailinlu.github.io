<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>fabric.js:一个强大又简单的canvas图库</title>
      <link href="/2022/04/19/fabric/chapter_one/"/>
      <url>/2022/04/19/fabric/chapter_one/</url>
      
        <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote><p><a href="http://fabricjs.com/"><font style="color:green">Fabric.js</font></a>是一个强大而简单的Javascript HTML5画图库,它提供了基于画布元素的交互式对象，并提供了svg与canvas之间相互转换的解析器。</p></blockquote><h2 id="模块详解"><a href="#模块详解" class="headerlink" title="模块详解"></a>模块详解</h2><blockquote><p>基于<a href="http://fabricjs.com/articles/"><font style="color:green">Fabric.js</font>章节引导</a>,对部分常规模块进行详细的编码与测试。ps:文档不定期更新，具体时间根据项目进度和实际使用过程决定。</p></blockquote><p><a href="http://fabricjs.com/test/">官方示例</a></p><h3 id="安装与初始化"><a href="#安装与初始化" class="headerlink" title="安装与初始化"></a>安装与初始化</h3><ul><li>安装</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install fabric</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or</span></span><br><span class="line">yarn add fabric</span><br></pre></td></tr></table></figure><ul><li>初始化</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> fabric <span class="keyword">from</span> <span class="string">&#x27;fabric&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建dom节点或者引用已挂载的canvas节点</span></span><br><span class="line"><span class="comment">// 可以是 HTMLElement | String</span></span><br><span class="line"><span class="keyword">let</span> canvasElement = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// option 是传入的配置参数，可设置一些默认参数</span></span><br><span class="line"><span class="comment">// 以下作为示例</span></span><br><span class="line"><span class="keyword">let</span> option = &#123;</span><br><span class="line">    <span class="attr">backgroundColor</span>: <span class="string">&quot;black&quot;</span>, <span class="comment">// 设置画布背景色为黑色</span></span><br><span class="line">    <span class="attr">width</span>: <span class="number">1920</span>,  <span class="comment">// 默认画布大小</span></span><br><span class="line">    <span class="attr">height</span>: <span class="number">1080</span>,</span><br><span class="line">    <span class="comment">/** 注意，若不想要框选功能，必须要置为false **/</span></span><br><span class="line">    <span class="attr">selection</span>: <span class="literal">false</span>, <span class="comment">// 关闭组框选</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> canvas = <span class="keyword">new</span> fabric.<span class="title class_">Canvas</span>(canvasElement, option);</span><br></pre></td></tr></table></figure><p>canvas对象除了以上的配置参数以外，还有一些其他的配置参数，以下做一个简单的列举，详细文档可参考官方文档。</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> canvasOption &#123;</span><br><span class="line">    <span class="comment">// 开启右键点击</span></span><br><span class="line">    <span class="attr">stopContextMenu</span>: <span class="built_in">boolean</span>, <span class="comment">// 阻止默认右键菜单弹出</span></span><br><span class="line">    <span class="attr">fireRightClick</span>: <span class="built_in">boolean</span>, <span class="comment">// 启用右键点击</span></span><br><span class="line">    <span class="comment">// 悬浮鼠标样式</span></span><br><span class="line">    <span class="attr">hoverCursor</span>: <span class="built_in">string</span>, <span class="comment">// &quot;pointer|hand 等，参考css cursor&quot;</span></span><br><span class="line">    <span class="comment">// 是否跳过当前视图范围外的图元渲染</span></span><br><span class="line">    <span class="attr">skipOffscreen</span>: <span class="built_in">boolean</span>,</span><br><span class="line">    <span class="comment">// 是否在添加和删除时渲染 </span></span><br><span class="line">    <span class="attr">renderOnAddRemove</span>: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="图形生成"><a href="#图形生成" class="headerlink" title="图形生成"></a>图形生成</h3><h4 id="常规图元"><a href="#常规图元" class="headerlink" title="常规图元"></a>常规图元</h4><blockquote><p>对于多数情况下，基于线、矩形、圆、椭圆、文本、三角形、多边形等基础图形的组合便能满足大部分的画图情况。</p></blockquote><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 矩形</span></span><br><span class="line"><span class="keyword">const</span> rect = <span class="keyword">new</span> fabric.<span class="title class_">Rect</span>(&#123;</span><br><span class="line">    <span class="attr">left</span>: <span class="number">250</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">150</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attr">fill</span>: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">    <span class="attr">stroke</span>: <span class="string">&quot;yellow&quot;</span>,</span><br><span class="line">    <span class="attr">originX</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="attr">originY</span>: <span class="string">&quot;center&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 圆形</span></span><br><span class="line"><span class="keyword">const</span> circle = <span class="keyword">new</span> fabric.<span class="title class_">Circle</span>(&#123;</span><br><span class="line">    <span class="attr">radius</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="attr">left</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="attr">fill</span>: <span class="string">&quot;blue&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 三角形</span></span><br><span class="line"><span class="keyword">const</span> triangle = <span class="keyword">new</span> fabric.<span class="title class_">Triangle</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">fill</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="attr">left</span>: <span class="number">150</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">50</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 线路</span></span><br><span class="line"><span class="keyword">const</span> line = <span class="keyword">new</span> fabric.<span class="title class_">Line</span>([<span class="number">100</span>, <span class="number">40</span>, <span class="number">200</span>, <span class="number">40</span>], &#123;</span><br><span class="line">    <span class="attr">stroke</span>: <span class="string">&quot;purple&quot;</span>,</span><br><span class="line">    <span class="attr">strokeWidth</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">strokeDashArray</span>: [<span class="number">3</span>, <span class="number">3</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 椭圆</span></span><br><span class="line"><span class="keyword">const</span> ellipse = <span class="keyword">new</span> fabric.<span class="title class_">Ellipse</span>(&#123;</span><br><span class="line">    <span class="attr">left</span>: <span class="number">220</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attr">rx</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="attr">ry</span>: <span class="number">15</span>,</span><br><span class="line">    <span class="attr">fill</span>: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">    <span class="attr">stroke</span>: <span class="string">&quot;yellow&quot;</span>,</span><br><span class="line">    <span class="attr">angle</span>: <span class="number">0</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文本</span></span><br><span class="line"><span class="keyword">const</span> text = <span class="keyword">new</span> fabric.<span class="title class_">Text</span>(<span class="string">&quot;欢迎来到我的博客！&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">fontFamily</span>: <span class="string">&#x27;Comic Sans&#x27;</span>,</span><br><span class="line">    <span class="attr">fontSize</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">fontWeight</span>: <span class="string">&quot;bold&quot;</span>,</span><br><span class="line">    <span class="attr">shadow</span>: <span class="string">&#x27;rgba(0,0,0,0.3) 5px 5px 5px&#x27;</span>,</span><br><span class="line">    <span class="attr">fill</span>: <span class="string">&quot;white&quot;</span>,</span><br><span class="line">    <span class="attr">stroke</span>: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">    <span class="attr">left</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">200</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 折线示例代码</span></span><br><span class="line"><span class="keyword">const</span> polyline = <span class="keyword">new</span> fabric.<span class="title class_">Polyline</span>(</span><br><span class="line">    [</span><br><span class="line">        &#123;<span class="attr">x</span>: <span class="number">10</span>, <span class="attr">y</span>: <span class="number">10</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">x</span>: <span class="number">50</span>, <span class="attr">y</span>: <span class="number">30</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">x</span>: <span class="number">40</span>, <span class="attr">y</span>: <span class="number">70</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">x</span>: <span class="number">60</span>, <span class="attr">y</span>: <span class="number">50</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">150</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">x</span>: <span class="number">40</span>, <span class="attr">y</span>: <span class="number">100</span>&#125;,</span><br><span class="line">    ],</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">stroke</span>: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="attr">top</span>: <span class="number">100</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多边形 示例代码 Polygon 是 Polyline的扩展</span></span><br><span class="line"><span class="keyword">const</span> points = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">4</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">16</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">3</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">30</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">5</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">25</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">55</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">19</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">44</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">15</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">30</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">15</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">55</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">9</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">55</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">53</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: -<span class="number">2</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">55</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: -<span class="number">4</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">40</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">20</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> polygon = <span class="keyword">new</span> fabric.<span class="title class_">Polygon</span>(points, &#123;</span><br><span class="line">    <span class="attr">left</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attr">fill</span>: <span class="string">&quot;#D81B60&quot;</span>,</span><br><span class="line">    <span class="attr">strokeWidth</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">stroke</span>: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">    <span class="attr">objectCaching</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">transparentCorners</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">cornerColor</span>: <span class="string">&quot;blue&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> shapes = [rect, circle, triangle, line, ellipse, text, polyline, polygon];</span><br><span class="line"></span><br><span class="line">canvas.<span class="title function_">add</span>(...shapes);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/shape.png" alt="基础图元示例"></p><p><a href="https://hailinlu.github.io/example/shape.html">常规图元完整演示</a></p><h4 id="复杂图元"><a href="#复杂图元" class="headerlink" title="复杂图元"></a>复杂图元</h4><blockquote><p>除了常规的图形之外，有时候也会需要绘制一些相对复杂一些的图形，比如说扇形等，另外也能通过加载图片和svg图形生成满足要求的美观的图形。</p></blockquote><ol><li>path路径图形</li></ol><p><em><strong>path路径可以实现大部分的复杂图形。以下以扇形和官网的demo为例，展示path路径图形的应用。</strong></em></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取椭圆上点的坐标 公式参考（https://blog.csdn.net/he_zhidan/article/details/81347426）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getSectorPathByEllipse</span>(<span class="params">cp, rx, ry, angle, czAngle</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> convertAngle = (<span class="title class_">Math</span>.<span class="property">PI</span> * angle) / <span class="number">180</span>;</span><br><span class="line">    <span class="keyword">let</span> convertCzAngle = (<span class="title class_">Math</span>.<span class="property">PI</span> * czAngle) / <span class="number">180</span>;</span><br><span class="line">    <span class="keyword">const</span> dLixin = <span class="title class_">Math</span>.<span class="title function_">atan2</span>(</span><br><span class="line">        rx * <span class="title class_">Math</span>.<span class="title function_">sin</span>(convertAngle),</span><br><span class="line">        ry * <span class="title class_">Math</span>.<span class="title function_">cos</span>(convertAngle)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">let</span> x =</span><br><span class="line">        rx * <span class="title class_">Math</span>.<span class="title function_">cos</span>(dLixin) * <span class="title class_">Math</span>.<span class="title function_">cos</span>(convertCzAngle) -</span><br><span class="line">        ry * <span class="title class_">Math</span>.<span class="title function_">sin</span>(dLixin) * <span class="title class_">Math</span>.<span class="title function_">sin</span>(convertCzAngle) +</span><br><span class="line">        cp.<span class="property">x</span>;</span><br><span class="line">    <span class="keyword">let</span> y =</span><br><span class="line">        rx * <span class="title class_">Math</span>.<span class="title function_">cos</span>(dLixin) * <span class="title class_">Math</span>.<span class="title function_">sin</span>(convertCzAngle) -</span><br><span class="line">        ry * <span class="title class_">Math</span>.<span class="title function_">sin</span>(dLixin) * <span class="title class_">Math</span>.<span class="title function_">cos</span>(convertCzAngle) +</span><br><span class="line">        cp.<span class="property">y</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;x, y&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取扇形路径 (startAngle &lt;= endAngle,range(0,360))</span></span><br><span class="line"><span class="comment">// cp 圆心 rx,ry 半径 rx &gt;= ry startAngle 起始角度 endAngle 终止角度</span></span><br><span class="line"><span class="comment">// sweepFlag 1 表示顺时针画弧线 0 为顺时针 largeArcFlag 启用大角度 czAngle 长轴角度</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getSectorPath</span>(<span class="params"></span></span><br><span class="line"><span class="params">    cp,</span></span><br><span class="line"><span class="params">    rx,</span></span><br><span class="line"><span class="params">    ry,</span></span><br><span class="line"><span class="params">    startAngle,</span></span><br><span class="line"><span class="params">    endAngle,</span></span><br><span class="line"><span class="params">    largeArcFlag = <span class="number">0</span>,</span></span><br><span class="line"><span class="params">    sweepFlag = <span class="number">0</span>,</span></span><br><span class="line"><span class="params">    czAngle = <span class="number">0</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> start = (<span class="title class_">Math</span>.<span class="property">PI</span> * startAngle) / <span class="number">180</span>,</span><br><span class="line">        end = (<span class="title class_">Math</span>.<span class="property">PI</span> * endAngle) / <span class="number">180</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> startP = <span class="title function_">getSectorPathByEllipse</span>(cp, rx, ry, startAngle, czAngle);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> endP = <span class="title function_">getSectorPathByEllipse</span>(cp, rx, ry, endAngle, czAngle);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 角度相差180，使用大角度</span></span><br><span class="line">    <span class="keyword">if</span> (endAngle - startAngle &gt; <span class="number">180</span>) &#123;</span><br><span class="line">        largeArcFlag = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`M<span class="subst">$&#123;cp.x&#125;</span> <span class="subst">$&#123;cp.y&#125;</span> L<span class="subst">$&#123;startP.x&#125;</span> <span class="subst">$&#123;startP.y&#125;</span> A <span class="subst">$&#123;rx&#125;</span> <span class="subst">$&#123;ry&#125;</span>, 0 ,<span class="subst">$&#123;largeArcFlag&#125;</span>, <span class="subst">$&#123;sweepFlag&#125;</span>, <span class="subst">$&#123;endP.x&#125;</span> <span class="subst">$&#123;endP.y&#125;</span> Z`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> paths = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= <span class="number">315</span>; i += <span class="number">45</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> path1 = <span class="keyword">new</span> fabric.<span class="title class_">Path</span>(</span><br><span class="line">        <span class="title function_">getSectorPath</span>(&#123;<span class="attr">x</span>: <span class="number">80</span>, <span class="attr">y</span>: <span class="number">80</span>&#125;, <span class="number">45</span>, <span class="number">45</span>, i, i + <span class="number">45</span>),</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">stroke</span>: <span class="string">&quot;white&quot;</span>,</span><br><span class="line">            <span class="attr">strokeWidth</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">fill</span>: <span class="string">&quot;blue&quot;</span>,</span><br><span class="line">            <span class="attr">selectable</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> path2 = <span class="keyword">new</span> fabric.<span class="title class_">Path</span>(</span><br><span class="line">        <span class="title function_">getSectorPath</span>(&#123;<span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">200</span>&#125;, <span class="number">80</span>, <span class="number">45</span>, i, i + <span class="number">45</span>),</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">stroke</span>: <span class="string">&quot;white&quot;</span>,</span><br><span class="line">            <span class="attr">strokeWidth</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">fill</span>: <span class="string">&quot;blue&quot;</span>,</span><br><span class="line">            <span class="attr">selectable</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    paths.<span class="title function_">push</span>(path1, path2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">canvas.<span class="title function_">add</span>(...paths);</span><br></pre></td></tr></table></figure><p><img src="/images/sector.png" alt="扇形示例图"></p><p><a href="https://hailinlu.github.io/example/sector.html">path路径画图完整演示</a></p><ol start="2"><li>图片&#x2F;svg加载</li></ol><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> bg_img = <span class="string">&#x27;https://cdn.jsdelivr.net/gh/hailinlu/own-blog-image/lzwk.jpg&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> image = <span class="string">&#x27;http://fabricjs.com/assets/honey_im_subtle.png&#x27;</span></span><br><span class="line"><span class="comment">// 设置背景图片</span></span><br><span class="line">canvas.<span class="title function_">setBackgroundImage</span>(bg_img, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 加载图片</span></span><br><span class="line">    fabric.<span class="property">Image</span>.<span class="title function_">fromURL</span>(image, <span class="function">(<span class="params">oImg</span>) =&gt;</span> &#123;</span><br><span class="line">        oImg.<span class="title function_">set</span>(<span class="string">&#x27;flipX&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">        canvas.<span class="title function_">add</span>(oImg);</span><br><span class="line">        <span class="comment">// 加载svg</span></span><br><span class="line">        fabric.<span class="title function_">loadSVGFromURL</span>(<span class="string">&quot;./icon.svg&quot;</span>, <span class="function">(<span class="params">objects, options</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> group = fabric.<span class="property">util</span>.<span class="title function_">groupSVGElements</span>(objects, &#123;</span><br><span class="line">                <span class="attr">left</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="attr">top</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="attr">scaleX</span>: <span class="number">0.08</span>,</span><br><span class="line">                <span class="attr">scaleY</span>: <span class="number">0.08</span></span><br><span class="line">            &#125;);</span><br><span class="line">            canvas.<span class="title function_">add</span>(group);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">originX</span>: <span class="string">&#x27;left&#x27;</span>,</span><br><span class="line">    <span class="attr">originY</span>: <span class="string">&#x27;top&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://hailinlu.github.io/example/imageloader.html">图片&#x2F;SVG加载完整示例</a></p><ol start="3"><li>可编辑文本框</li></ol><h3 id="坐标系统"><a href="#坐标系统" class="headerlink" title="坐标系统"></a>坐标系统</h3><blockquote><p>官方对于坐标系统的单元测试示例包括<a href="http://fabricjs.com/test/misc/origin.html">常规画布坐标系统</a> 和 <a href="http://fabricjs.com/test/misc/grouporigin.html">组内坐标系统</a>。</p></blockquote><p>从<a href="http://fabricjs.com/test/misc/origin.html">常规画布坐标系统</a>的官方示例可以看出，<font style="color:green">originX</font>和<font style="color:green">originY</font>确定了基准点的位置不同,以rect为例，originX的可选项[“left”,”right”,”center”],代表了rect对象的left属性对应的位置是在左侧&#x2F;右侧&#x2F;中间，originY的可选项[“top”,”bottom”,”center”]，代表rect对象top属性分别对应上方&#x2F;下方&#x2F;中间。<br><a href="http://fabricjs.com/test/misc/grouporigin.html">组内坐标系统</a>的示例遵循相同的规律，不同点在于，组合成组后，group的left，top属性会受到相应的影响，若group初始并未设置left&#x2F;top&#x2F;width&#x2F;height等属性，则会根据组内元素的位置生成自身的位置和大小。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取传入参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getArguments</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> textOriginX = $(<span class="string">&quot;#text-originX-select&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">    <span class="keyword">let</span> textOriginY = $(<span class="string">&quot;#text-originY-select&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">    <span class="keyword">let</span> circleOriginX = $(<span class="string">&quot;#circle-originX-select&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">    <span class="keyword">let</span> circleOriginY = $(<span class="string">&quot;#circle-originY-select&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">    <span class="keyword">let</span> textLeft = <span class="built_in">parseFloat</span>($(<span class="string">&quot;#text-left&quot;</span>).<span class="title function_">val</span>());</span><br><span class="line">    <span class="keyword">let</span> textTop = <span class="built_in">parseFloat</span>($(<span class="string">&quot;#text-top&quot;</span>).<span class="title function_">val</span>());</span><br><span class="line">    <span class="keyword">let</span> circleLeft = <span class="built_in">parseFloat</span>($(<span class="string">&quot;#circle-left&quot;</span>).<span class="title function_">val</span>());</span><br><span class="line">    <span class="keyword">let</span> circleTop = <span class="built_in">parseFloat</span>($(<span class="string">&quot;#circle-top&quot;</span>).<span class="title function_">val</span>());</span><br><span class="line">    <span class="keyword">let</span> groupLeft = <span class="built_in">parseFloat</span>($(<span class="string">&quot;#group-left&quot;</span>).<span class="title function_">val</span>());</span><br><span class="line">    <span class="keyword">let</span> groupTop = <span class="built_in">parseFloat</span>($(<span class="string">&quot;#group-top&quot;</span>).<span class="title function_">val</span>());</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        textOriginX, textOriginY, circleOriginX, circleOriginY,</span><br><span class="line">        textLeft, textTop, circleLeft, circleTop, groupLeft, groupTop</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">originExample</span>(<span class="params">option</span>) &#123;</span><br><span class="line">    canvas.<span class="title function_">clear</span>();</span><br><span class="line">    canvas.<span class="title function_">set</span>(<span class="string">&quot;backgroundColor&quot;</span>, <span class="string">&quot;gray&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        textOriginX = <span class="string">&quot;left&quot;</span>, textOriginY = <span class="string">&quot;top&quot;</span>, circleOriginX = <span class="string">&quot;left&quot;</span>, circleOriginY = <span class="string">&quot;top&quot;</span>,</span><br><span class="line">        textLeft = <span class="number">0</span>, textTop = <span class="number">0</span>, circleLeft = <span class="number">0</span>, circleTop = <span class="number">0</span>, groupLeft = <span class="number">0</span>, groupTop = <span class="number">0</span></span><br><span class="line">    &#125; = option;</span><br><span class="line">    <span class="keyword">const</span> text = <span class="keyword">new</span> fabric.<span class="title class_">Text</span>(<span class="string">&quot;text&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">left</span>: textLeft,</span><br><span class="line">        <span class="attr">top</span>: textTop,</span><br><span class="line">        <span class="attr">originX</span>: textOriginX,</span><br><span class="line">        <span class="attr">originY</span>: textOriginY,</span><br><span class="line">        <span class="attr">fill</span>: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">        <span class="attr">stroke</span>: <span class="string">&quot;yellow&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> circle = <span class="keyword">new</span> fabric.<span class="title class_">Circle</span>(&#123;</span><br><span class="line">        <span class="attr">radius</span>: <span class="number">50</span>,</span><br><span class="line">        <span class="attr">left</span>: circleLeft,</span><br><span class="line">        <span class="attr">top</span>: circleTop,</span><br><span class="line">        <span class="attr">originX</span>: circleOriginX,</span><br><span class="line">        <span class="attr">originY</span>: circleOriginY,</span><br><span class="line">        <span class="attr">fill</span>: <span class="string">&quot;blue&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> group = <span class="keyword">new</span> fabric.<span class="title class_">Group</span>([circle, text], &#123;</span><br><span class="line">        <span class="attr">left</span>: groupLeft,</span><br><span class="line">        <span class="attr">top</span>: groupTop,</span><br><span class="line">        <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="attr">height</span>: <span class="number">100</span></span><br><span class="line">    &#125;);</span><br><span class="line">    canvas.<span class="title function_">add</span>(group);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(group.<span class="property">left</span>, group.<span class="property">top</span>, group.<span class="property">width</span>, group.<span class="property">height</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://hailinlu.github.io/example/origin.html">完整示例代码</a></p><h3 id="事件系统"><a href="#事件系统" class="headerlink" title="事件系统"></a>事件系统</h3><h4 id="基础事件"><a href="#基础事件" class="headerlink" title="基础事件"></a>基础事件</h4><h4 id="基于事件的变换"><a href="#基于事件的变换" class="headerlink" title="基于事件的变换"></a>基于事件的变换</h4><h3 id="canvas动画"><a href="#canvas动画" class="headerlink" title="canvas动画"></a>canvas动画</h3><h3 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h3><blockquote><p>大量元素要同时渲染到画布上,必定会影响到实际的渲染性能，根据原始官网的示例, 是通过将<font style="color:green">canvas.renderOnAddRemove</font>和<font style="color:green">fabric.Object.prototype.objectCaching</font>两个属性值修改为false。那除了这些属性外，还有哪些方面会影响整体的渲染性能呢？</p></blockquote><ul><li>大量元素渲染(noGroup vs Group vs Group-Clone)</li></ul><p><em><strong>首先，我针对以下三种情况做一个简单的对比:（1）元素直接绘制于画布之上；（2）元素绘制于group中；（3）绘制引用图元，并通过克隆引用图元，添加到画布上</strong></em></p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 画图函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCanvas</span>(<span class="params">flag = <span class="number">1</span>, itemCount = <span class="number">1</span></span>) &#123;</span><br><span class="line">    $(<span class="string">&quot;.canvas-container&quot;</span>).<span class="title function_">remove</span>();</span><br><span class="line">    <span class="keyword">const</span> getRandomInt = fabric.<span class="property">util</span>.<span class="property">getRandomInt</span>;</span><br><span class="line">    <span class="keyword">const</span> rainbow = [<span class="string">&quot;#ffcc66&quot;</span>, <span class="string">&quot;#ccff66&quot;</span>, <span class="string">&quot;#66ccff&quot;</span>, <span class="string">&quot;#ff6fcf&quot;</span>, <span class="string">&quot;#ff6666&quot;</span>];</span><br><span class="line">    <span class="keyword">const</span> rainbowEnd = rainbow.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 无组渲染</span></span><br><span class="line">    <span class="keyword">if</span> (flag === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> canvasElement = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> canvas = <span class="keyword">new</span> fabric.<span class="title class_">Canvas</span>(canvasElement, &#123;</span><br><span class="line">            <span class="attr">backgroundColor</span>: <span class="string">&quot;black&quot;</span>,</span><br><span class="line">            <span class="attr">width</span>: <span class="number">600</span>,</span><br><span class="line">            <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">            <span class="attr">selection</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">renderOnAddRemove</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> begin = +<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> groups = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="number">5000</span>; index++) &#123;</span><br><span class="line">            <span class="keyword">let</span> items = [];</span><br><span class="line">            <span class="keyword">let</span> left = <span class="title function_">getRandomInt</span>(<span class="number">0</span>, <span class="number">600</span>);</span><br><span class="line">            <span class="keyword">let</span> top = <span class="title function_">getRandomInt</span>(<span class="number">0</span>, <span class="number">600</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; itemCount; i++) &#123;</span><br><span class="line">                <span class="keyword">let</span> rect = <span class="keyword">new</span> fabric.<span class="title class_">Rect</span>(&#123;</span><br><span class="line">                    left,</span><br><span class="line">                    top,</span><br><span class="line">                    <span class="attr">width</span>: <span class="number">5</span>,</span><br><span class="line">                    <span class="attr">height</span>: <span class="number">5</span>,</span><br><span class="line">                    <span class="attr">fill</span>: rainbow[<span class="title function_">getRandomInt</span>(<span class="number">0</span>, rainbowEnd)],</span><br><span class="line">                    <span class="attr">objectCaching</span>: <span class="literal">false</span>,</span><br><span class="line">                    <span class="attr">selectable</span>: <span class="literal">false</span>,</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                items.<span class="title function_">push</span>(rect);</span><br><span class="line">            &#125;</span><br><span class="line">            groups.<span class="title function_">push</span>(...items);</span><br><span class="line">        &#125;</span><br><span class="line">        canvas.<span class="title function_">add</span>(...groups);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(canvas.<span class="property">wrapperEl</span>);</span><br><span class="line">        <span class="keyword">let</span> end = +<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`无组渲染耗时：<span class="subst">$&#123;end - begin&#125;</span>ms,元素数量:<span class="subst">$&#123;itemCount * <span class="number">5000</span>&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 成组非拷贝渲染</span></span><br><span class="line">    <span class="keyword">if</span> (flag === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> canvasElement1 = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> canvas1 = <span class="keyword">new</span> fabric.<span class="title class_">Canvas</span>(canvasElement1, &#123;</span><br><span class="line">            <span class="attr">backgroundColor</span>: <span class="string">&quot;black&quot;</span>,</span><br><span class="line">            <span class="attr">width</span>: <span class="number">600</span>,</span><br><span class="line">            <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">            <span class="attr">selection</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">renderOnAddRemove</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> begin = +<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> groups = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="number">5000</span>; index++) &#123;</span><br><span class="line">            <span class="keyword">let</span> items = [];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; itemCount; i++) &#123;</span><br><span class="line">                <span class="keyword">let</span> rect = <span class="keyword">new</span> fabric.<span class="title class_">Rect</span>(&#123;</span><br><span class="line">                    <span class="attr">width</span>: <span class="number">5</span>,</span><br><span class="line">                    <span class="attr">height</span>: <span class="number">5</span>,</span><br><span class="line">                    <span class="attr">fill</span>: rainbow[<span class="title function_">getRandomInt</span>(<span class="number">0</span>, rainbowEnd)],</span><br><span class="line">                    <span class="attr">objectCaching</span>: <span class="literal">false</span>,</span><br><span class="line">                    <span class="attr">selectable</span>: <span class="literal">false</span>,</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                items.<span class="title function_">push</span>(rect);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> group = <span class="keyword">new</span> fabric.<span class="title class_">Group</span>(items, &#123;</span><br><span class="line">                <span class="attr">left</span>: <span class="title function_">getRandomInt</span>(<span class="number">0</span>, <span class="number">600</span>),</span><br><span class="line">                <span class="attr">top</span>: <span class="title function_">getRandomInt</span>(<span class="number">0</span>, <span class="number">600</span>),</span><br><span class="line">                <span class="attr">objectCaching</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">selectable</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            groups.<span class="title function_">push</span>(group);</span><br><span class="line">        &#125;</span><br><span class="line">        canvas1.<span class="title function_">add</span>(...groups);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(canvas1.<span class="property">wrapperEl</span>);</span><br><span class="line">        <span class="keyword">let</span> end = +<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">            <span class="string">`成组非拷贝渲染耗时：<span class="subst">$&#123;end - begin&#125;</span>ms,组数:5000,组内元素数量:<span class="subst">$&#123;itemCount&#125;</span>`</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拷贝渲染</span></span><br><span class="line">    <span class="keyword">if</span> (flag === <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> canvasElement2 = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> canvas2 = <span class="keyword">new</span> fabric.<span class="title class_">Canvas</span>(canvasElement2, &#123;</span><br><span class="line">            <span class="attr">backgroundColor</span>: <span class="string">&quot;black&quot;</span>,</span><br><span class="line">            <span class="attr">width</span>: <span class="number">600</span>,</span><br><span class="line">            <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">            <span class="attr">selection</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">renderOnAddRemove</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> begin = +<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> items = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; itemCount; i++) &#123;</span><br><span class="line">            <span class="keyword">let</span> rect = <span class="keyword">new</span> fabric.<span class="title class_">Rect</span>(&#123;</span><br><span class="line">                <span class="attr">width</span>: <span class="number">5</span>,</span><br><span class="line">                <span class="attr">height</span>: <span class="number">5</span>,</span><br><span class="line">                <span class="attr">fill</span>: rainbow[<span class="title function_">getRandomInt</span>(<span class="number">0</span>, rainbowEnd)],</span><br><span class="line">                <span class="attr">objectCaching</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">selectable</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            items.<span class="title function_">push</span>(rect);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> group = <span class="keyword">new</span> fabric.<span class="title class_">Group</span>(items, &#123;</span><br><span class="line">            <span class="attr">left</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">top</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">selectable</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">objectCaching</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> groups = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="number">5000</span>; index++) &#123;</span><br><span class="line">            <span class="keyword">let</span> item = fabric.<span class="property">util</span>.<span class="property">object</span>.<span class="title function_">clone</span>(group);</span><br><span class="line">            item.<span class="property">left</span> = <span class="title function_">getRandomInt</span>(<span class="number">0</span>, <span class="number">600</span>);</span><br><span class="line">            item.<span class="property">top</span> = <span class="title function_">getRandomInt</span>(<span class="number">0</span>, <span class="number">600</span>);</span><br><span class="line">            item.<span class="property">objectCaching</span> = <span class="literal">false</span>;</span><br><span class="line">            item.<span class="property">selectable</span> = <span class="literal">false</span>;</span><br><span class="line">            groups.<span class="title function_">push</span>(item);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        canvas2.<span class="title function_">add</span>(...groups);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(canvas2.<span class="property">wrapperEl</span>);</span><br><span class="line">        <span class="keyword">let</span> end = +<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">            <span class="string">`成组拷贝渲染耗时：<span class="subst">$&#123;end - begin&#125;</span>ms,组数:5000,组内元素数量:<span class="subst">$&#123;itemCount&#125;</span>`</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://hailinlu.github.io/example/multiple.html">大量元素渲染完整演示</a></p><ul><li>toSVG()添加额外属性</li></ul><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// fabric.canvas.toSVG() 函数并未提供额外的参数导出，可通过重写toSVG方法，实现自定义属性输出</span></span><br><span class="line"><span class="comment">// 方法一 字符串插入</span></span><br><span class="line">fabric.<span class="property">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toSVG</span> = <span class="keyword">function</span> (<span class="params">reviver</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> markup = <span class="variable language_">this</span>.<span class="title function_">_createBaseSVGMarkup</span>(<span class="variable language_">this</span>.<span class="title function_">_toSVG</span>(reviver), &#123;</span><br><span class="line">        <span class="attr">reviver</span>: reviver</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> index = markup.<span class="title function_">indexOf</span>(<span class="string">&#x27;&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> insertStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> [<span class="string">&#x27;keyid&#x27;</span>, <span class="string">&#x27;state&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>[key]) <span class="keyword">continue</span>;</span><br><span class="line">        insertStr += <span class="string">` <span class="subst">$&#123;key&#125;</span>=&quot;<span class="subst">$&#123;<span class="variable language_">this</span>[key]&#125;</span>&quot; `</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    markup = markup.<span class="title function_">slice</span>(<span class="number">0</span>, index) + insertStr + markup.<span class="title function_">slice</span>(index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> markup;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二 通过dom操作，引入jquery.js </span></span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&#x27;jquery&#x27;</span>;</span><br><span class="line"></span><br><span class="line">fabric.<span class="property">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toSVG</span> = <span class="keyword">function</span> (<span class="params">reviver</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> markup = <span class="variable language_">this</span>.<span class="title function_">_createBaseSVGMarkup</span>(<span class="variable language_">this</span>.<span class="title function_">_toSVG</span>(reviver), &#123;</span><br><span class="line">        <span class="attr">reviver</span>: reviver</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> infoTag = <span class="variable language_">document</span>.<span class="title function_">createAttributeNS</span>(<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span>, <span class="string">&#x27;info-tag&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> [<span class="string">&#x27;keyid&#x27;</span>, <span class="string">&#x27;state&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>[key]) <span class="keyword">continue</span>;</span><br><span class="line">        $(info).<span class="title function_">attr</span>(key, <span class="variable language_">this</span>[key]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(markup).<span class="title function_">append</span>(infoTag);</span><br><span class="line">    markup = $(markup).<span class="property">children</span>[<span class="number">0</span>].<span class="property">outerHTML</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> markup;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 经过实际项目验证，方法一的导出效率更高，若有其他更高效的方法，欢迎指教。</span></span><br></pre></td></tr></table></figure><h3 id="清空与销毁"><a href="#清空与销毁" class="headerlink" title="清空与销毁"></a>清空与销毁</h3><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2>]]></content>
      
      
      <categories>
          
          <category> fabric使用教程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>个人知识图谱</title>
      <link href="/2022/04/13/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/"/>
      <url>/2022/04/13/%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>自2018年从事前端工作至今，已有4个年头，遇到过很多问题，也解决过很多技术难题，却缺少一份自我沉淀，缺少一段重温。<br>以此篇文章作为开篇，书写一些感想，分享一些经验，同时汲取一些同行和大佬们的经验。</p><h2 id="开篇"><a href="#开篇" class="headerlink" title="开篇"></a>开篇</h2><blockquote><p>技术的积累非一朝一夕之功，时间是最好的帆船，带着我遨游知识的海洋。经过多年的工作与学习，不断地积累，<br>同时结合一些他人的经验，简单整理了下方这张前端知识图谱，抛砖引玉，若有片面，敬请指正。(PS:后续持续补充)</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/hailinlu/own-blog-image/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1.png" alt="思维导图"></p><h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>书卷即将展开，学习的脚步从未停止，扬帆起航，你我同行……</p>]]></content>
      
      
      <categories>
          
          <category> 思维导图 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端知识图谱 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
